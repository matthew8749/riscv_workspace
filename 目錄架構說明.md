# SoC專案目錄架構說明

## 整體架構

```
prj_000/
├── 1-rtl/           # RTL 設計檔案
│   ├── soc/         # SoC 設計模組
│   ├── sim_model/   # 模擬用檔案(testbench)
│   ├── file_list/   # 檔案清單
│   ├── macro/       # 巨集定義
│   └── share/       # 共用檔案
│
├── 2-sim/           # 模擬環境
│   ├── sim_000/
│   ├── sim_001/
│   └── ...
│
├── 3-script/
│   ├── dc/          # Design Compiler 合成
│   ├── fpga/        # FPGA 合成
│   ├── makefile/    # Makefile 腳本
│   ├── memgen/      #
│   ├── LINT/        # 程式碼品質檢查
│   ├── pt/          # prime time
│   ├── ...
│   ├── ...
│   └── ...
│
├── 5-todo/
│
│
│
│
├── (暫時沒有)CDC/             # Clock Domain Crossing 驗證
├── (暫時沒有)RDC/             # Reset Domain Crossing 驗證
```
## RTL 區域詳細說明  
### `1-rtl/soc/` - SoC 設計模組  
  
  - `soc_top.sv`: SoC 頂層模組，整合各 IP 並負責對外介面, 包含IP以外的控制邏輯和連接.
  - `dip_***/`: Digital IP 模組   （如 `dip_async_fifo/`、`dip_uart/`）。  
  - `aip_***/`: Analog IP 模組    （如 `aip_adc/`，可包含行為模型或空殼佔位）。  

### `1-rtl/sim_model/` - 模擬相關檔案（testbench）  
  
  - `sim_top.sv`: soc_top.sv 的 testbench
  - `mdl_xxx`: 各IP模組的simulation model和testbench
    - 支援分 IP 管理，如 `mdl_async_fifo/`、`mdl_uart/` 等目錄。  
      - `*_monitor.sv`、`*_checker.sv`: 監控與檢查模組。  
      - `test_patterns.sv`: 測試向量與刺激來源。  

### `1-rtl/file_list/` - 檔案清單管理
  
  - 每個模組都有對應 .f 檔管理。   
  - 使用符號連結(link)而非複製檔案  
  - 規範:   
    - 設計檔與測試檔分開管理。   
    - 模擬清單（如 `mdl_xxx.f`）可包含設計清單（如 `dip_xxx.f`）。  
    - 所有檔案皆以 `+incdir+` 明確指定 include 目錄。  
  - **重要**: file_list 盡量不要巢狀包含其他 file_list ，除非是在mdl的filelist中(見第三點說明)   

### `1-rtl/macro/` - 巨集與行為模型  

  ```bash
  macro/
  ├── bhvr/
  │   ├── iopad/       # IO pad 行為模型
  │   ├── ram/         # RAM 行為模型
  │   └── rom/         # ROM 行為模型

  ```


## 實作範例: Async FIFO

假設要實作一個 async_fifo 模組，按照此架構的作法: 

### 1. 建立硬體設計目錄
```bash
1-rtl/soc/dip_async_fifo/
├── async_fifo_top.sv       # 頂層模組
├── async_fifo_ctrl.sv      # 控制邏輯
├── gray_counter.sv         # Gray counter
└── sync_r2w.sv            # 讀寫指標同步
```

### 2. 建立模擬目錄
```bash
1-rtl/sim_model/mdl_async_fifo/
├── sim_async_fifo.sv       # Testbench主檔
├── fifo_monitor.sv         # 監控模組
└── test_patterns.sv       # 測試向量
```

### 3. 建立檔案清單
**1-rtl/file_list/dip_async_fifo.f**
```
# Async FIFO design files
+incdir+../soc/dip_async_fifo
../soc/dip_async_fifo/gray_counter.sv
../soc/dip_async_fifo/sync_r2w.sv
../soc/dip_async_fifo/async_fifo_ctrl.sv
../soc/dip_async_fifo/async_fifo_top.sv
```

**1-rtl/file_list/mdl_async_fifo.f**
```
# Include design files (這是允許的巢狀包含情況)
-f dip_async_fifo.f

# Simulation files
+incdir+../sim_model/mdl_async_fifo
../sim_model/mdl_async_fifo/test_patterns.sv
../sim_model/mdl_async_fifo/fifo_monitor.sv
../sim_model/mdl_async_fifo/sim_async_fifo.sv
```

### 4. 模擬執行
在 `2-sim/sim_xxx/` 目錄中執行模擬時: 
```bash
# 使用 mdl_async_fifo.f 作為頂層檔案清單
# 它會自動包含設計檔案 (dip_async_fifo.f) 和測試檔案
```
先將3-script/makefile link到 sim_async_fifo/   
```
ln -s ../../3-script/makefile Makefile
```

## 設計原則

1. **分離關注點**    : 設計 RTL、模擬 Testbench、腳本 Script 各自有獨立層級目錄。
2. **模組化**       : 每個 IP 模組對應獨立目錄，設計與模擬各自分層。
3. **重用性**       : 使用 `+incdir+` 與 `-f` 清單避免重複拷貝，同一份 RTL 可重複測試。
4. **版本可擴展**    : `2-sim/` 支援多版本測試情境如 sim_000、sim_001；可快速切換測資。
4. **階層管理**      : 模擬的file_list可以包含設計的file_list
5. **命名標準化**    : 統一的命名規則便於維護和協作，DIP = Digital IP, AIP = Analog IP, MDL = 模擬模組，檔案統一命名慣例。
6. **可合成可模擬**  : 所有設計檔皆可供 FPGA 合成、EDA tool 合成與模擬使用。